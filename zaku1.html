<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zaku Checkout</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .checkout-container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; margin-bottom: 20px; }
    .product-summary { text-align: center; margin-bottom: 20px; }
    .product-summary img { width: 120px; border-radius: 8px; margin-bottom: 10px; }
    label { font-weight: bold; margin-top: 10px; display: block; }
    input, select, button { width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    button { background: #000; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #333; }
    .note { font-size: 13px; color: #666; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="checkout-container">
    <h2>Checkout</h2>

    <!-- Product summary -->
    <div id="checkoutProduct" class="product-summary"></div>

    <form id="checkoutForm">
      <label for="name">Full Name</label>
      <input type="text" id="name" required>

      <label for="email">Email Address</label>
      <input type="email" id="email" required>

      <label for="location">Location</label>
      <select id="location" required>
        <option value="">-- Select Location --</option>
        <option value="Covenant University">Covenant University</option>
        <option value="Crawford University">Crawford University</option>
        <option value="Bells University">Bells University</option>
      </select>

      <label for="hall">Hall / Hostel</label>
      <input type="text" id="hall" required>

      <label for="room">Room Number</label>
      <input type="text" id="room" required>

      <label for="tieType">Type of Tie</label>
      <select id="tieType" required>
        <option value="Fat Tie">Fat Tie</option>
        <option value="Slim Tie">Slim Tie</option>
      </select>

      <label for="designOption">Personal Design</label>
      <select id="designOption" required>
        <option value="none">None (already selected a design)</option>
        <option value="custom">Customized my design</option>
      </select>

      <div id="designLinkContainer" style="display:none;">
        <label for="designLink">Design Link</label>
        <input type="url" id="designLink" placeholder="Paste your design link">
      </div>

      <label for="receipt">Upload Payment Receipt</label>
      <input type="file" id="receipt" accept="image/*" required>
      <p class="note">Please upload a clear screenshot/photo of your Flutterwave payment receipt.</p>

      <a href="https://flutterwave.com/pay/o0dqtghhsfpa" target="_blank">
        <button type="button">Click Here to Pay with Flutterwave</button>
      </a>

      <button type="submit">Submit Order</button>
    </form>
  </div>
  
  
  
  <!-- Spinner (hidden by default) -->
<div id="loadingSpinner" style="
  display:none;
  text-align:center;
  margin:15px 0;
  font-size:14px;
  color:#555;
">
  <div class="spinner" style="
    border: 4px solid #f3f3f3;
    border-top: 4px solid #000;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    margin: 0 auto 10px auto;
    animation: spin 1s linear infinite;
  "></div>
  Sending your order...
</div>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

  

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function() {
      emailjs.init("YY4CxWOe6PLFrzQ4x"); // Replace with your EmailJS Public Key
    })();

    // âœ… Load selected product from localStorage
    const product = JSON.parse(localStorage.getItem("zakuSelectedProduct"));
    if (product) {
      document.getElementById("checkoutProduct").innerHTML = `
        <img src="${product.img}" alt="${product.name}">
        <h3>${product.name}</h3>
        <p>â‚¦${product.price}</p>
      `;
    }

    // Show/hide design link input
    document.getElementById("designOption").addEventListener("change", function () {
      document.getElementById("designLinkContainer").style.display =
        this.value === "custom" ? "block" : "none";
    });

    // Handle checkout form
    document.getElementById("checkoutForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const receiptFile = document.getElementById("receipt").files[0];
      if (!receiptFile) {
        alert("Please upload your payment receipt.");
        return;
      }
      
      // Show spinner when form starts sending
document.getElementById("loadingSpinner").style.display = "block";

      // ðŸ”¼ Upload receipt to Cloudinary
      const formData = new FormData();
      formData.append("file", receiptFile);
      formData.append("upload_preset", "Receipt_upload");
 // e.g. zaku_unsigned

      fetch("https://api.cloudinary.com/v1_1/dmqfprtcj/image/upload", {
        method: "POST",
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        const receiptUrl = data.secure_url; // âœ… hosted receipt link

        // Collect order data
        const orderData = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          location: document.getElementById("location").value,
          hall: document.getElementById("hall").value,
          room: document.getElementById("room").value,
          tieType: document.getElementById("tieType").value,
          designChoice: document.getElementById("designOption").value,
          designLink: document.getElementById("designLink").value,
          productName: product ? product.name : "",
          productPrice: product ? product.price : "",
          total: product ? product.price : 3000,
          receipt: receiptUrl,
          date: new Date().toLocaleString()
        };

        // Send via EmailJS
        // Upload to Cloudinary and send via EmailJS...
emailjs.send("service_osgs50m", "template_i3e2mac", orderData)
  .then(function(response) {
    // Hide spinner
    document.getElementById("loadingSpinner").style.display = "none";

    alert("âœ… Form submitted successfully!");
    setTimeout(() => {
      window.location.href = "success.html";
    }, 2000);
  }, function(error) {
    // Hide spinner
    document.getElementById("loadingSpinner").style.display = "none";

    alert("âŒ Failed to submit form. Please try again.");
  });
      })
      .catch(err => {
        alert("Failed to upload receipt. Try again.");
        console.error(err);
      });
    });
  </script>
</body>
</html>




